try {

	//global variable for async
	var propertag = propertag || {};
	propertag.cmd = propertag.cmd || [];
	if(window.performance) {
		propertag.load_ts = window.performance.now();
	}
	var properSpecialOps = properSpecialOps || {};

	//Set Options
	const Loader = function(win, document, ignoreParam) {

		var ad_code_domain = "global.proper.io" || "global.proper.io"; // domain to load ad code from
		var session_persistent = 0; // User keeps same version id throughout session
		var last_release_ts = "2023-11-27 10:43:20";  // Last time a file was released from split test
		var publisher = "upi";
		var proper_ad_block_message = 0; // Flag if proper ad block message should be enabled
		var multi_dfp = 0; // Whether or not to Load GTP (loads when multi_dfp is FALSE)

		var cookie_name = "proper_rtp_split_test";
		var cookieData  = {
			"version_id": null, // Session version id
			"release_ts": null  // Time this cookie was set
		};

		const stagingParam = checkStagingParam(ad_code_domain);
		if(stagingParam && !ignoreParam) {
			loadStagingLoader(stagingParam, publisher);
			return;
		}

		/**
		 * Rtp Files.
		 *
		 * If One Version:
		 *
		 * { version_id: config }
		 *
		 * If Split version:
		 *
		 * { version_id: rtp_version_id }
		 */

		// List of rtp files
		var rtp_files = {"26089":{"dfp_id":"1009753","domain":"upi.com","floors":{"mobile":{"sizes":{"400x300":2,"640x480":2},"backup":0.1},"desktop":{"sizes":{"400x300":2,"640x480":2},"backup":0.1}},"schain":{"ver":"1.0","nodes":[{"hp":1,"asi":"proper.io","sid":"f87d3dee-ba65-11eb-8272-06ef03bc0096"}],"complete":1},"bidders":{"s2s":{"sovrn_s2s":{"enabled":false,"site_id":"263069","tag_ids":{"mobile":[{"320x50":["968891-1","968891-2","968891-3","968891-4","968891-5"],"300x250":["968891-1","968891-2","968891-3"]}],"desktop":[{"728x90":["968891-6","968891-7"],"160x600":["968891-5"],"300x250":["968891-1","968891-2","968891-3","968891-4","968891-5"],"300x600":["968891-4"],"970x250":["968891-6","968891-7"]}]}},"yahoo_s2s":{"enabled":false,"site_id":"8a9695b5017979f794bcf7b743e7000e","tag_ids":{"mobile":[{"320x50":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2","8a969dea017979f78bd1f7bb9996005d-3","8a969dea017979f78bd1f7bb9996005d-4","8a969dea017979f78bd1f7bb9996005d-5"],"300x250":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2","8a969dea017979f78bd1f7bb9996005d-3"]}],"desktop":[{"728x90":["8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"],"160x600":["8a96912c017979f79059f7bb98a10037-5"],"300x250":["8a96912c017979f79059f7bb98a10037-1","8a96912c017979f79059f7bb98a10037-2","8a96912c017979f79059f7bb98a10037-3","8a96912c017979f79059f7bb98a10037-4","8a96912c017979f79059f7bb98a10037-5"],"300x600":["8a96912c017979f79059f7bb98a10037-4"],"970x250":["8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"]}]}},"gumgum_s2s":{"test":false,"enabled":false,"site_id":"rm3lr58d","tag_ids":{"mobile":[{"sticky_horizontal":["1"]}],"desktop":[{"sticky_horizontal":["1"]}]}},"adaptmx_s2s":{"enabled":true,"site_id":"cHJvcGVyLmlv","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"]}]}},"mediagrid_s2s":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["83037","83039","83038","83040"],"300x250":["83037","83039","83038"]}],"desktop":[{"728x90":["83034","83035"],"160x600":["83036"],"300x250":["83031","83030","83032","83033"],"300x600":["83033"],"970x250":["83034","83035"]}]}},"aol_instream_s2s":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"aol_outstream_s2s":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"sovrn_instream_s2s":{"enabled":true,"site_id":"263069","tag_ids":{"mobile":[{"400x300":["968572-1"]}],"desktop":[{"640x480":["968572-1"]}]}},"sovrn_outstream_s2s":{"enabled":true,"site_id":"263069","tag_ids":{"mobile":[{"400x300":["968572-1","968572-2","968572-3"]}],"desktop":[{"640x480":["968572-1","968572-2","968572-3"]}]}},"yahoo_outstream_s2s":{"enabled":false,"site_id":"8a9695b5017979f794bcf7b743e7000e","tag_ids":{"mobile":[{"400x300":["8a969506017d7d4832a353a6190e0a81-1","8a969506017d7d4832a353a6190e0a81-2","8a969506017d7d4832a353a6190e0a81-3"]}],"desktop":[{"640x480":["8a969506017d7d4832a353a6190e0a81-1","8a969506017d7d4832a353a6190e0a81-2","8a969506017d7d4832a353a6190e0a81-4"]}]}}},"header":{"a9":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"emx":{"enabled":false,"site_id":"148901","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"index":{"enabled":true,"site_id":"679380","tag_ids":{"mobile":[{"320x50":["320x50-1","320x50-2","320x50-3","320x50-4","320x50-5"],"300x250":["300x250-1","300x250-2","300x250-3"]}],"desktop":[{"728x90":["728x90-1","728x90-2","728x90-3","728x90-4"],"160x600":["160x600-1"],"300x250":["300x250-1","300x250-2","300x250-3","300x250-4","300x250-5"],"300x600":["300x600-1"],"970x250":["970x90-1","970x90-2"]}]}},"kargo":{"enabled":false,"tag_ids":{"mobile":[{"320x50":["_sXhTBVhUIV"],"300x250":["_xtXzoBC7up"]}]}},"ogury":{"enabled":true,"site_id":"OGY-34E4F6CB458C","tag_ids":{"mobile":[{"sticky_horizontal":["bd58f510-5c3c-013a-264d-0242ac120004"]}]}},"openx":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["544095248","544095247","544095252","544095251","544095256"],"300x250":["544095248","544095247","544095252"]}],"desktop":[{"728x90":["544095245","544095237"],"160x600":["544095241"],"300x250":["544095242","544095243","544095244","544095241","544095238"],"300x600":["544095241"],"970x250":["544095245","544095237"]}]}},"sovrn":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["916078","916079","916080","916081"],"300x250":["916076","916077"]}],"desktop":[{"728x90":["916068","916069"],"160x600":["916072"],"300x250":["916063","916064","916065","916066"],"300x600":["916067"],"970x250":["916074","916075"]}]}},"teads":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["134227-147375-1","134227-147375-2","134227-147375-3","134227-147375-4"],"300x250":["134227-147375-1","134227-147375-2","134227-147375-3"],"native_horizontal":["156252-170728-1","156252-170728-2","156252-170728-3"]}],"desktop":[{"728x90":["134227-147375-6","134227-147375-7","134227-147375-8","134227-147375-9"],"160x600":["134227-147375-4"],"300x250":["134227-147375-1","134227-147375-2","134227-147375-3"],"300x600":["134227-147375-4"],"970x250":["134227-147375-6","134227-147375-7"],"native_horizontal":["156252-170728-1","156252-170728-2","156252-170728-3"]}]}},"yahoo":{"enabled":false,"site_id":"8a9695b5017979f794bcf7b743e7000e","tag_ids":{"mobile":[{"320x50":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2","8a969dea017979f78bd1f7bb9996005d-3","8a969dea017979f78bd1f7bb9996005d-4","8a969dea017979f78bd1f7bb9996005d-5"],"300x250":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2","8a969dea017979f78bd1f7bb9996005d-3"]}],"desktop":[{"728x90":["8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"],"160x600":["8a96912c017979f79059f7bb98a10037-5"],"300x250":["8a96912c017979f79059f7bb98a10037-1","8a96912c017979f79059f7bb98a10037-2","8a96912c017979f79059f7bb98a10037-3","8a96912c017979f79059f7bb98a10037-4","8a96912c017979f79059f7bb98a10037-5"],"300x600":["8a96912c017979f79059f7bb98a10037-4"],"970x250":["8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"]}]}},"criteo":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"gumgum":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["rm3lr58d-284939","rm3lr58d-302249","rm3lr58d-302250","rm3lr58d-302251"],"300x250":["rm3lr58d-284937","rm3lr58d-302243","rm3lr58d-302244"]}],"desktop":[{"728x90":["rm3lr58d-284943","rm3lr58d-302247"],"160x600":["rm3lr58d-284934"],"300x250":["rm3lr58d-284937","rm3lr58d-302243","rm3lr58d-302244","rm3lr58d-302245","rm3lr58d-302246"],"300x600":["rm3lr58d-284938"],"970x250":["rm3lr58d-284945","rm3lr58d-302248"]}]}},"mantis":{"test":false,"enabled":false,"site_id":"60ae66d26f5619000fb3f1b5","tag_ids":{"mobile":[{"320x50":["upi_320x50-1","upi_320x50-2"],"300x250":["upi_300x250-1","upi_300x250-2"]}],"desktop":[{"728x90":["upi_728x90-1","upi_728x90-2"],"160x600":["upi_160x600-1"],"300x250":["upi_300x250-1","upi_300x250-2"],"300x600":["upi_300x600-1"],"970x250":["upi_970x250-1"]}]}},"sonobi":{"enabled":false,"tag_ids":{"mobile":[{"320x50":["982d8f7c07844d579a06","cf2a0758296355b1354a","e2f48ed78ea63ddd4d22","e0e98e89da3c04e5b677"],"300x250":["9def47444028e5701c6a","e41142df22d92ff930c5"]}],"desktop":[{"728x90":["cf2bb5411fab49203c78","65af045d98064476e433"],"160x600":["8ff575ccba39cea32fe3"],"300x250":["e2af3ca8ed5d3bc9f6c1","619cf3af57e11375c2d7","be8701653a55fea338b5","8d7a181ba5b312ac8522"],"300x600":["9c4c249c50c5f1c2bdf0"]}]}},"unruly":{"enabled":false,"site_id":"257870","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"rubicon":{"enabled":true,"site_id":"378202","tag_ids":{"mobile":[{"320x50":["2087934-1","2087934-2","2087934-3","2087934-4","2087934-5"],"300x250":["2087934-1","2087934-2","2087934-3"]}],"desktop":[{"728x90":["2087932-6","2087932-7","2087932-8","2087932-9"],"160x600":["2087932-4"],"300x250":["2087932-1","2087932-2","2087932-3","2087932-4","2087932-5"],"300x600":["2087932-4"],"970x250":["2087932-6","2087932-7"]}]}},"vidazoo":{"enabled":true,"site_id":"59ac17c192832d0011283fe3","tag_ids":{"mobile":[{"320x50":["638f9e20ba1056ce9c06add8-1","638f9e20ba1056ce9c06add8-2","638f9e20ba1056ce9c06add8-3","638f9e20ba1056ce9c06add8-4"],"300x250":["638f9e20ba1056ce9c06add8-1","638f9e20ba1056ce9c06add8-2","638f9e20ba1056ce9c06add8-3"]}],"desktop":[{"728x90":["638f9e20ba1056ce9c06add8-6","638f9e20ba1056ce9c06add8-7","638f9e20ba1056ce9c06add8-8","638f9e20ba1056ce9c06add8-9"],"160x600":["638f9e20ba1056ce9c06add8-4"],"300x250":["638f9e20ba1056ce9c06add8-1","638f9e20ba1056ce9c06add8-2","638f9e20ba1056ce9c06add8-3","638f9e20ba1056ce9c06add8-4","638f9e20ba1056ce9c06add8-5"],"300x600":["638f9e20ba1056ce9c06add8-4"]}]}},"appnexus":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["24377795","24377797","24377798","24377801","24377827"],"300x250":["24377795","24377797","24377798"],"320x480":["24377795","24377797","24377798"]}],"desktop":[{"728x90":["24377789","24377792"],"160x600":["24377786"],"300x250":["24377783","24377784","24377785","24377786","24377787"],"300x600":["24377786"],"320x480":["24377783","24377784","24377785"],"970x250":["24377789","24377792"]}]}},"medianet":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"],"320x480":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"320x480":["desktop-1","desktop-2","desktop-3"],"970x250":["desktop-6","desktop-7"]}]}},"pubmatic":{"pub_id":"","enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"risecodes":{"enabled":true,"site_id":"62cd287f9766d400014b7880","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4","mobile-5"],"300x250":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-6","desktop-7","desktop-8","desktop-9"],"160x600":["desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4","desktop-5"],"300x600":["desktop-4"]}]}},"undertone":{"enabled":true,"site_id":"3520","tag_ids":{"mobile":[{"320x50":["3520019"],"300x250":["3520017"],"native_horizontal":["3520014"],"sticky_horizontal":["3520012"]}],"desktop":[{"728x90":["3520018"],"160x600":["3520016"],"300x250":["3520017"],"native_horizontal":["3520015"],"sticky_horizontal":["3520013"]}]}},"triplelift":{"enabled":true,"tag_ids":{"desktop":[{"728x90":["upi_desktop-6","upi_desktop-7","upi_desktop-8","upi_desktop-9"],"160x600":["upi_desktop-4"],"300x250":["upi_desktop-1","upi_desktop-2","upi_desktop-3","upi_desktop-4","upi_desktop-5"],"300x600":["upi_desktop-4"],"970x250":["upi_desktop-6","upi_desktop-7"],"native_vertical":["upi_ad_4_300x250","upi_ad_5_300x250","upi_ad_6_300x250"],"native_horizontal":["upi_ad_1_300x250","upi_ad_2_300x250","upi_ad_3_300x250"]}]}},"ix_instream":{"enabled":true,"site_id":"719465-719466","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"justpremium":{"test":false,"enabled":false,"tag_ids":{"mobile":[{"sticky_horizontal":["122885"]}],"desktop":[{"sticky_horizontal":["122885"]}]}},"adx_instream":{"enabled":false},"districtmdmx":{"test":false,"enabled":false},"emx_instream":{"enabled":false,"site_id":"155383","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"ix_outstream":{"enabled":true,"site_id":"679381-679382","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"sharethrough":{"enabled":true,"tag_ids":{"mobile":[{"320x480":["KJRbcRH09hYHONdpVg7JRSQC","ZTPDgQELX9GSXK2CVXgCsz7e","Kzttp8J1Gafd4Q6xn46fRJ42"],"native_horizontal":["9cFnbv7DGapcghMuhD34QwDr","rOqhrOa215lIZd2dClCbqxcq","CaqfWt1XEw92CLj9xySTHCPT"]}],"desktop":[{"320x480":["rtX5bwYz3h8QPKzf1U6tmU8o","ZBmi2qNj2vAqC8lfOqnGZrUX","mTjzzXxIjrP0ALkwy6y5TK1R"],"native_vertical":["6Ra2172E9APeYrjmleBEZlNn","AnJeZFgMGA52fQTo2RUQur4N","Yx1I35UitWmIX4DecygjkkpL"],"native_horizontal":["NTqcaNGxrBSpEaJDumlMyDMq","zQXtWdnOWgIRXsmECiUAWMRd","Uv3PYAxVoO9xDRcRfwyqnHLL"]}]}},"emx_outstream":{"enabled":false,"site_id":"154100","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"smart_adserver":{"enabled":false,"site_id":"519495","tag_ids":{"mobile":[{"320x50":["1625709-46691","1625709-46633","1625709-46636","1625709-46635","1625709-46632"],"300x250":["1625709-46691","1625709-46633","1625709-46636"]}],"desktop":[{"728x90":["1625708-92850","1625708-97167"],"160x600":["1625708-46635"],"300x250":["1625708-46691","1625708-46633","1625708-46636","1625708-46635","1625708-46632"],"300x600":["1625708-46635"],"970x250":["1625708-92850","1625708-97167"]}]}},"spotx_instream":{"enabled":true,"site_id":"319353-319354","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"openx_outstream":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["545661641","545661644","545661645"]}],"desktop":[{"640x480":["545661640","545661642","545661643"]}]}},"spotx_outstream":{"enabled":false,"site_id":"317964-317965","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"unruly_instream":{"enabled":true,"site_id":"257870","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"rubicon_instream":{"enabled":true,"site_id":"8777","tag_ids":{"mobile":[{"400x300":["2158788-1"]}],"desktop":[{"640x480":["2158788-1"]}]}},"sonobi_outstream":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["73538fe7c07cb85340d6","acfe649764aec7db9453","caf403dd7f120ff47280"]}],"desktop":[{"640x480":["b6bce00ab7f563cb81f9","63c19decfb42d70b677c","d12668ea9a7f80a9bfbf"]}]}},"unruly_outstream":{"enabled":false,"site_id":"257870","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"pubmatic_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["upi_instream_mobile"]}],"desktop":[{"640x480":["upi_instream_desktop"]}]}},"rubicon_outstream":{"enabled":true,"site_id":"\t378202","tag_ids":{"mobile":[{"400x300":["2724850-1","2724850-2","2724850-3"]}],"desktop":[{"640x480":["2724850-1","2724850-2","2724850-3"]}]}},"thirtythreeacross":{"test":false,"enabled":false,"tag_ids":{"mobile":[{"320x50":["dTiqc4ZFOr66bCaKj0P0Le","dX5kpOZFOr66bCaKj0P0Le","d29WcMZFOr66bCaKj0P0Le","d78XbEZFOr66bCaKj0P0Le"],"300x250":["dTiqc4ZFOr66bCaKj0P0Le","dX5kpOZFOr66bCaKj0P0Le"]}],"desktop":[{"728x90":["dikp1mZFOr66bCaKj0P0Le","dnk45OZFOr66bCaKj0P0Le"],"160x600":["dBSR_eZFOr66bCaKj0P0Le"],"300x250":["dikp1mZFOr66bCaKj0P0Le","dnk45OZFOr66bCaKj0P0Le","dsmFFgZFOr66bCaKj0P0Le","dxcRH4ZFOr66bCaKj0P0Le"],"300x600":["dxcRH4ZFOr66bCaKj0P0Le"],"970x250":["dITmVMZFOr66bCaKj0P0Le","dN7rR6ZFOr66bCaKj0P0Le"]}]}},"appnexus_outstream":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["24377802","24377805","24377807"]}],"desktop":[{"640x480":["24377790","24377794","24377804"]}]}},"medianet_outstream":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"pubmatic_outstream":{"enabled":false,"tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"amazon_tam_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["instream_1"]}],"desktop":[{"640x480":["instream_1"]}]}},"beachfront_instream":{"enabled":false,"site_id":"97cf62d8-6728-484a-88c1-d1f996bfa146","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"risecodes_outstream":{"enabled":true,"site_id":"62cd287f9766d400014b7880","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"amazon_tam_outstream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["Outstream_400x300-1","Outstream_400x300-2","Outstream_400x300-3"]}],"desktop":[{"640x480":["Outstream_640x480-1","Outstream_640x480-2","Outstream_640x480-3"]}]}},"beachfront_outstream":{"enabled":false,"site_id":"eb1985cf-693d-419b-ee26-3d1a81c96314","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"thirtythreeacross_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["b8yynQfJ8r7ikTaKj0P0Le"]}],"desktop":[{"640x480":["dOdUdcfJ4r7ikTaKj0P0Le"]}]}}}},"refresh":{"mobile":{"max":30,"enabled":true,"interval":60000,"exclude_dfp":0,"inview_interval":3000},"desktop":{"max":30,"enabled":true,"interval":60000,"exclude_dfp":0,"inview_interval":3000}},"userIds":{"identityAdapters":{"id5id":{"name":"id5Id","config":{"enabled":true},"storage":{"name":"id5id","type":"localstorage","expiresInDays":90,"refreshInSeconds":28800}},"publink":{"name":"pubLink","config":{"enabled":true},"storage":{"name":"publink","type":"cookie","expiresInDays":30}},"sharedid":{"name":"sharedId","config":{"enabled":true},"storage":{"name":"sharedid","type":"cookie","expiresInDays":30,"refreshInSeconds":86400}},"fabrickid":{"name":"fabrickId","config":{"apiKey":null,"enabled":false},"storage":{"name":"fabrickId","type":"cookie","expiresInDays":7}},"pubcommonid":{"name":"pubCommonId","config":{"enabled":true},"storage":{"name":"_pubcid","type":"localstorage","expiresInDays":365}},"identitylink":{"name":"identityLink","config":{"enabled":true,"urlParameter":""},"storage":{"name":"idl_env","type":"cookie","expiresInDays":30}},"verizonmediaid":{"name":"verizonMediaId","config":{"enabled":true},"storage":{"name":"connectid","type":"localstorage","expiresInDays":15}}}},"ad_slots":{"video":{"upi_instream_1":{"number":1,"sticky":false,"mcm_type":"mcm","video_player":"upi_instream","resolution_size_map":{"0":["400x300"],"768":["640x480"]}}},"display":{"upi_left_1":{"number":2,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-left-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-left-1","cssplacement":"append"}},"resolution_size_map":{"0":[],"1660":["160x600"]}},"upi_sticky":{"number":8,"sticky":true,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-sticky","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-sticky","cssplacement":"append"}},"refresh":{"mobile":{"max":30,"enabled":true,"interval":15000},"desktop":{"max":30,"enabled":true,"interval":15000}},"sticky_settings":{"brand":true,"close_btn":true},"resolution_size_map":{"0":["320x50","sticky_horizontal"],"768":["728x90","sticky_horizontal"],"1000":["728x90","970x90","sticky_horizontal"]}},"upi_right_1":{"number":3,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":1,"renderMarginPercent":1},"desktop":{"enabled":true},"device_specific":true},"resolution_size_map":{"0":["300x250","320x50"],"901":["300x250","native_vertical"]}},"upi_right_2":{"number":5,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-2","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-2","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":1,"renderMarginPercent":1},"desktop":{"enabled":true},"device_specific":true},"resolution_size_map":{"0":["300x250","320x50"],"901":["300x250","native_vertical"]}},"upi_right_3":{"flex":true,"number":6,"sticky":false,"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"flex_map":{"0":[],"992":{"160x600":1,"300x250":2,"300x600":1,"native_vertical":1}},"mcm_type":"mcm","resolution_size_map":{"0":[],"992":["160x600","300x250","300x600","native_vertical"]}},"upi_slideshow":{"number":9,"sticky":false,"mcm_type":"mcm","resolution_size_map":{"0":[],"901":["300x600","300x250","160x600","native_vertical"]}},"upi_quiz_right":{"number":10,"sticky":false,"refresh":{"mobile":{"enabled":true,"interval":60000},"desktop":{"enabled":true,"interval":60000}},"mcm_type":"mcm","resolution_size_map":{"0":[],"1260":["300x250","300x600","native_vertical","160x600"]}},"upi_leaderboard":{"number":1,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-leaderboard","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-leaderboard","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000,"exclude_dfp":false},"desktop":{"enabled":true,"exclude_dfp":false},"device_specific":true},"lazyload":{"device_specific":true},"resolution_size_map":{"0":["320x50"],"768":["728x90"],"1000":["728x90"]}},"upi_content_dynamic":{"flex":true,"number":7,"sticky":false,"dynamic":{"mobile":{"enabled":true,"cssselector":".upi-content","cssplacement":"after"},"desktop":{"enabled":true,"cssselector":".upi-content","cssplacement":"after"}},"flex_map":{"0":{"fluid":1,"320x50":1,"300x250":1,"320x480":1,"336x280":1,"400x300":1,"native_horizontal":1},"768":{"300x250":2,"320x480":1,"336x280":1,"640x480":1,"native_horizontal":1}},"lazyload":{"mobile":{"enabled":true},"desktop":{"enabled":true},"device_specific":true},"video_player":"upi_outstream","video_enabled":true,"resolution_size_map":{"0":["300x250","320x50","400x300","fluid","336x280","native_horizontal","320x480"],"768":["300x250","640x480","336x280","native_horizontal","320x480"]}},"upi_gallery_right_1":{"flex":true,"number":4,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":15000},"desktop":{"enabled":true,"interval":15000}},"flex_map":{"0":[],"960":{"160x600":1,"300x250":2,"300x600":1,"native_vertical":1}},"resolution_size_map":{"0":[],"960":["300x250","native_vertical","300x600","160x600"]}}}},"auctions":{"mobile":{"max":10,"rounds":1,"timeout":58000},"desktop":{"max":10,"rounds":1,"timeout":58000},"resolution_size_map":{"0":["320x50","sticky_horizontal","300x250","400x300","fluid","336x280","native_horizontal","320x480"],"768":["728x90","sticky_horizontal","300x250","640x480","336x280","native_horizontal","320x480"],"901":["300x250","native_vertical","300x600","160x600"],"960":["300x250","native_vertical","300x600","160x600"],"992":["160x600","300x250","300x600","native_vertical"],"1000":["728x90","970x90","sticky_horizontal"],"1260":["300x250","300x600","native_vertical","160x600"],"1660":["160x600"]}},"extra_js":"\/\/ Vidazoo Script\nvar script = document.createElement('script');\nscript.src = 'https:\/\/static.vidazoo.com\/basev\/vwpt.js';\nscript.defer = true;\nscript.setAttribute('data-widget-id', \"6410c665185f3da35bfaeb4d\");\nscript.type = 'text\/javascript';\nvar scpt = document.getElementsByTagName('script')[0];\nscpt.parentNode.insertBefore(script, scpt);","lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":100,"renderMarginPercent":100},"desktop":{"enabled":true,"fetchMarginPercent":85,"renderMarginPercent":85},"device_specific":true},"mcm_type":"mcm","extra_css":".proper-ad-unit.ad-sticky .close:before {\n  background-color:white !important;\n}\n.proper-ad-unit.ad-sticky .close:after {\n-webkit-transform: rotate(0deg) !important;\n-moz-transform: rotate(0deg) !important;\n-ms-transform: rotate(0deg) !important;\n-o-transform: rotate(0deg) !important;\ntransform: rotate(0deg) !important;\ntop:0 !important;\nbackground-color: white !important;\n}\n\nbody{ --proper-video-accent-color: #006699}","site_name":"upi","default_tags":["rise"],"dfp_per_slot":0,"video_players":{"upi_instream":{"player_settings":{"autoplay":true,"backfill":false,"video_id":"","video_type":"instream","backfill_id":"","dfp_ad_unit":"upi_instream_1","small_player":"never","number_of_ads":5,"ad_failure_limit":5,"no_ads_no_player":false,"small_player_bottom":100}},"upi_outstream":{"player_settings":{"autoplay":true,"backfill":false,"video_id":"","video_type":"outstream","backfill_id":"","dfp_ad_unit":"","small_player":"never","number_of_ads":10,"ad_failure_limit":5,"no_ads_no_player":true,"small_player_bottom":100}}},"report_ad_tool":false,"sandbox_iframe":1,"sandbox_options":["allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts"],"rtp_file_version":26089,"domain_protection":true,"google_advertiser":42904576,"proper_advertiser":600883576,"rtp_file_revision":"latest","additional_domains":[],"traffic_percentage":1}};

		// List of custom tags
		var rtp_default_tags = [];

		// Traffic Percentages
		var traffic_percentages = {"26089":1};
		var getVersionId = weightedRandom(traffic_percentages);

		function run() {

			// Check if ad project code has already been loaded
			if (typeof ProperMedia !== 'undefined' && typeof ProperMedia.ad_project !== 'undefined') {
				console.warn('Proper Media\'s ad code has already been loaded');
				return false;
			}

			if(!multi_dfp){
				window.googletag = window.googletag || {};
				window.googletag.cmd = window.googletag.cmd || [];

				if(!window.googletag._loadStarted_) {
				    (function() {
				    var gads = document.createElement('script');
				    gads.async = true;
				    gads.type = 'text/javascript';
				    var useSSL = 'https:' == document.location.protocol;
				    gads.src = (useSSL ? 'https:' : 'http:') +
				    '//securepubads.g.doubleclick.net/tag/js/gpt.js';
				    var node = document.getElementsByTagName('script')[0];
				    node.parentNode.insertBefore(gads, node);
				    })();
				}
			}

			// Check if Ad Blocker is enabled
			detectAdBlockPlugins()

			// Init version id
			var version_id   = null,
				clear_cookie = false,
				config 		 = null;

			// Check for clear cookie flag
			var get_vars = getUrlParameters(window.location.search.substring(1));
			if(typeof get_vars["vselect_clear"] !== "undefined" && get_vars["vselect_clear"] == 1) {
				clear_cookie = true;
			}
			// Check for version id in url
			if(typeof get_vars["vselect"] !== "undefined" && get_vars["vselect"] && rtp_files[get_vars["vselect"]]) {
				version_id = get_vars["vselect"];
			} else if (typeof get_vars["p_default_tag"] !== "undefined" && get_vars["p_default_tag"] && rtp_default_tags[get_vars["p_default_tag"]] && rtp_default_tags[get_vars["p_default_tag"]].length) {
				// get the first version listed if duplicate tags
				version_id = rtp_default_tags[get_vars["p_default_tag"]][0];
			}

			// Check for session persistent
			if(session_persistent) {
				// Get cookie data
				getSplitTestCookie();

				// Convert dates
				d1 = new Date(cookieData['release_ts']);
				d2 = new Date(last_release_ts);

				// Check if cookie data is out of date
				if(d1 < d2 || !cookieData['version_id'] || !rtp_files[cookieData['version_id']] || version_id || clear_cookie) {
					cookieData['version_id'] = version_id || getVersionId();  // Generate version id based on traffic share
					cookieData['release_ts'] = last_release_ts;   // Update release ts
				}
				// Set new cookie data
				setSplitTestCookie();

				version_id = cookieData['version_id'];
			} else {
				// Generate version id based on traffic share
				version_id = version_id || getVersionId();
			}

			// Check if proper ad block message should be enabled
			activateAdBlockMsg();

			var versions = Object.keys(rtp_files);
			// Find and Activate Config Object.
			if (rtp_files[version_id]) {
				if (versions.length == 1) {
					var config = rtp_files[version_id];
					activatePayload(config.rtp_file_revision);
					activateConfig(config);
				} else {
					var payload_name = rtp_files[version_id];
					activatePayload(payload_name);
					fetchConfig(version_id, function (config) {
						activateConfig(config);
					});
				}
			}
		}

		/**
		 * Activate the Config Object.
		 *
		 * @param {object} config RtpJ Config Object.
		 */
		function activateConfig(config) {
			if(config.amazon_advertiser) {
				config.aaba30b = "";
				config._0x4d3546 = "";
			}
			propertag.cmd.unshift(function () {
				ProperMedia.ad_project.set_options(config);
			});
		}

		/**
		 * Add event listener of ad blockers to show proper ad block message
		 */
		function activateAdBlockMsg() {
			if(proper_ad_block_message) {
				window.addEventListener("proper-ad-bidders-blocked", loadProperMessage);
			}
		}

		/**
         * Load Proper Ad Block Message
         */
        function loadProperMessage() {

            function showProperMessage() {
                try {
                    var ProperMediaMessage = window.ProperMediaMessage || {};
                    ProperMediaMessage.project.show_shield_message('', publisher);
                } catch(e) {
                    console.error(e);
                }
            }

            if(
                !window.ProperMediaMessage ||
                !window.ProperMediaMessage.project ||
                !window.ProperMediaMessage.show_shield_message
            ) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.src = "https://propermessage.io/design/assets/bundle-message.js";
                script.onload = showProperMessage;
                document.getElementsByTagName("head")[0].appendChild(script);
            } else {
                showProperMessage()
            }
        }

		/**
		 * Grab the Config from the remote server.
		 *
		 * @param {*} version_id The Version Id to fetch.
		 * @param {*} callback Function that will be passed the parsed config.
		 */
		function fetchConfig(version_id, callback) {
			var req = new XMLHttpRequest();

			var listener = function () {
				var config = safeJsonParse(this.responseText);
				if(typeof callback == 'function') {
					callback(config);
				}
			};

			req.addEventListener("load", listener);
			req.open("GET", "https://" + ad_code_domain + "/config/" + publisher + "." + version_id + '.json');
			req.send();
		}

		/**
		 * Activate the Payload!
		 *
		 * @param {string} payload_name The Payload Release Name.
		 */
		function activatePayload(payload_name) {
			// Main ad code file
			var script = document.createElement("script");

			script.onerror = function() {
				payload_loaded = false;
                // Payload was blocked, trigger this event
                var event = new CustomEvent('proper-ad-bidders-blocked', {});
                window.dispatchEvent(event);
            }

        	payload_loaded = true;
			var payload = 'https://' + ad_code_domain + '/payloads/' + payload_name + '.js';
			script.type = "text/javascript";
			script.src = payload;
			document.getElementsByTagName("head")[0].appendChild(script);
		}

		// Weighted Random @see https://stackoverflow.com/questions/8435183/generate-a-weighted-random-number
		function weightedRandom(spec) {
			if (!spec) {
				return function() {};
			}

			var ids = Object.keys(spec);

			if (ids.length == 1) {
				return function () { return ids[0] };
			}

			var i, j, table = [];
			for (i in spec) {
				// The constant 10000 below should be computed based on the
				// weights in the spec for a correct and optimal table size.
				// E.g. the spec {0:0.999, 1:0.001} will break this impl.
				for (j=0; j<spec[i]*10000; j++) {
					table.push(i);
				}
			}
			return function() {
				return table[Math.floor(Math.random() * table.length)];
			}
		}

		function getSplitTestCookie() {
			// Get cookie value
			var cookie_string_value = getCookieValue(cookie_name) || '{}';

			// Set settion object
			var cookieSplitTestData = safeJsonParse(cookie_string_value) || {};
			cookieData = {
				"version_id": cookieSplitTestData['version_id'] || null,
				"release_ts": cookieSplitTestData['release_ts'] || null
			}
		}

		function setSplitTestCookie() {
			// stringify data
			var encoded_cookie_value = JSON.stringify(cookieData);
			// save session cookie
			setCookieValue(encoded_cookie_value);
		}

		function getCookieValue(a) {
			var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
			return b ? b.pop() : undefined;
		}

		function setCookieValue(value) {
			document.cookie = cookie_name + "=" + value + "; path=/;";
		}

		function getUrlParameters(url) {
			var data = decodeURIComponent(url).split('&');
			var res = {};
			for (var i = 0; i < data.length; i++) {
				var parm = data[i].split('=');
				res[parm[0]] = parm[1];
			}
			return res;
		}

		/**
		* Detect if a user has an ad block plugin by loading pixels
		*/
		function detectAdBlockPlugins() {
			window.properSpecialOps = window.properSpecialOps || {};

			var checksRemain = 2,
			error1  = false,
			error2  = false,
			px      = 'https://abcheck.proper.io/px.gif?ch=*&rn=*',
			adblock = {
				'detected': false,
				'acceptable_ads': false
			};

			function checkImages() {
				if (--checksRemain) return;
				if(error2) {
					adblock.detected = true;
					if(!error1) {
						adblock.acceptable_ads = true;
					} else {
						adblock.acceptable_ads = false;
					}

					window.properSpecialOps.adblock = adblock;

					// Enough bidders were blocked, must be an adblocker
					var event = new CustomEvent('proper-adblock-pixels-blocked', {});
					window.dispatchEvent(event);
				}
			}

			//send request
			var random   = (Math.random() * 11).toString();
			var img1     = new Image;
			img1.onload  = checkImages;
			img1.onerror = function () {
				error1 = true;
				checkImages();
			};
			img1.src = px.replace(/\*/, '1').replace(/\*/, random);

			//send request
			var img2     = new Image;
			img2.onload  = checkImages;
			img2.onerror = function () {
				error2 = true;
				checkImages();
			};
			img2.src = px.replace(/\*/, '2').replace(/\*/, random);
		}

		/**
		 * safeJSONParse
		 *
		 * Makes an attempt to parse a JSON safely, but might fail miserably.
		 *
		 * @param {String} the json
		 *
		 * @returns {JSON|null} JSON is parsed, Null if not.
		 *
		 */
		function safeJsonParse(json) {
			try {
				return JSON.parse(json);
			} catch(e) {
				console.error(e);
			}
			return null;
		}

		/**
         * CustomEvent polyfill for IE
         */
        if(!window.CustomEvent !== "function" ) {
            window.CustomEvent = function CustomEvent ( event, params ) {
                params = params || { bubbles: false, cancelable: false, detail: null };
                var evt = document.createEvent( 'CustomEvent' );
                evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );
                return evt;
            }
		};

		// Placeholder for Google Funding Choices.
		

		function checkStagingParam(ad_code_domain) {
			const get_vars = getUrlParameters(window.location.search.substring(1));
			const staging_param = get_vars["proper_staging"];
			const subdomain = ad_code_domain.replace(".proper.io", "");

			if (staging_param === "1" && subdomain !== "global-staging")
				return "global-staging";
			else if (typeof staging_param === "string" && staging_param !== "1" && subdomain !== staging_param)
				return staging_param;
			else
				return false;
		}

		function loadStagingLoader(subdomain, publisher) {
			const src = `https://${subdomain}.proper.io/${publisher}.min.js`;

			fetch(src)
			.then(response => {
				if (response.ok) {
					return response.text();
				} else {
					throw new Error(`Response from ${src} was not ok.`);
				}
			})
			.then(loader => {
				const script = document.createElement('script');
				script.type = 'text/javascript';
				script.text = loader;
				document.getElementsByTagName('head')[0].appendChild(script);
			})
			.catch(error => {
				console.error(`Error loading requested Sovrn loader: ${error.message}`);
				Loader(win, document, true);
			})
		}

		run();

	};

	Loader(window, document);
} catch (e) {
	console.error(e);
	if(typeof TraceKit !== "undefined") {
		TraceKit.report(e); //error with stack trace gets normalized and sent to subscriber
	}
}

window.properSpecialOps = window.properSpecialOps || {};
window.properSpecialOps.country='IT';
window.properSpecialOps.region='';
window.properSpecialOps.uspcDoesApply = false;
window.properSpecialOps.gppDoesApply=true;
window.properSpecialOps.gppSection='EU';
window.properSpecialOps.gdprDoesApply=true;
