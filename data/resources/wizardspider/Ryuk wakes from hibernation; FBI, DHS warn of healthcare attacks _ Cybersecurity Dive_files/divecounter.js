function Divecounter(){const interstitialPageCount=3;const interstitialMinDays=3;const cookieName='_divecounter';const cookieExpire=365;let data={page_views:0,is_subscriber:false,hide:false,last_shown:0,first_page_view:0,is_staff:false,};this.testing=function(){return location.search.indexOf('show_hit_ad')!==-1||location.search.indexOf('show_interstitial')!==-1;};this.resetCookie=function(){setCookie(cookieName,'',-100);};this.countPageViews=function(){if(data.page_views===0){data.first_page_view=(new Date()).getTime();}
data.page_views++;return data.page_views;};this.canShow=function(pageCount=interstitialPageCount,minDays=interstitialMinDays){if(data.is_subscriber||data.hide){return false;}
if(data.page_views>0&&data.page_views%pageCount===0){if(!data.last_shown||(new Date()).getTime()-data.last_shown>=minDays*24*60*60*1000){return true;}}
return false;};this.markShown=function(){data.last_shown=(new Date()).getTime();};this.markSubscriber=function(valueIn){var value=(typeof valueIn==='undefined')?true:!!value;data.is_subscriber=value;};this.markStaff=function(valueIn){var value=(typeof valueIn==='undefined')?true:!!value;data.is_staff=value;};this.save=function(){writeData();};this.getData=function(){return data;};this.getOption=function(key){var defaults={showSignupAd:false,showWhichAd:false,markStaff:false,};if((typeof divecounter_settings!=='undefined')&&(key in divecounter_settings)){return divecounter_settings[key];}
return defaults[key];};this.prettyPrint=function(){var s='';for(var data_key in data){if(!data.hasOwnProperty(data_key)||(['hide'].indexOf(data_key)>=0)){continue;}
var data_value=data[data_key];if(['first_page_view','last_shown'].indexOf(data_key)>=0){if(parseInt(data_value,10)>0){data_value=(new Date(parseInt(data_value,10))).toString();}else{data_value='';}}
s+=data_key+': '+data_value+'\n';}
s+='initial referrer: '+getCookie('_referrer')+'\n';s+='screen dimensions: '+window.screen.availWidth.toString()+'x'+window.screen.availHeight.toString()+'\n';return s.trim();};var setCookie=function(c_name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+'='+escape(value)+
((expiredays===null)?'':';expires='+exdate.toUTCString())+'; path=/';};var getCookie=function(c_name){var c_start;var c_end;if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+'=');if(c_start!==-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(';',c_start);if(c_end===-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end));}}
return '';};var readData=function(){var c=getCookie(cookieName);var arr;if(c!==''){arr=c.split('\t');data.page_views=arr[0];data.is_subscriber=!!parseInt(arr[1],10);data.hide=!!parseInt(arr[2],10);data.last_shown=arr[3];if(arr.length>4){data.first_page_view=arr[4];}
if(arr.length>5){data.is_staff=!!parseInt(arr[5],10);}}};var buildCookie=function(){var arr=[data.page_views,data.is_subscriber?1:0,data.hide?1:0,data.last_shown,data.first_page_view,data.is_staff?1:0,];return arr.join('\t');};var writeData=function(){setCookie(cookieName,buildCookie(),cookieExpire);};readData();}
function divecounter_close_ad(){$.modal.close();var _gaq=window._gaq||(window._gaq=[]);_gaq.push(['_trackEvent','EmailSignup','InterstitialClosed',undefined,undefined,true]);$('body').removeClass('no-scroll');}
function isAtLeastOneNewsletterSelected(){return $('#newsletter-list-section li input:checked').length>0;}
function isSignupWithMultiPub(){return $('#newsletter-list-section li input').length>0;}
function isNewsletterSelectionValid(){return isSignupWithMultiPub()?isAtLeastOneNewsletterSelected():true;}
function isUserConsentChecked(){return $('#interstitial-consent-container input:checked').length>0;}
function windowLargeEnough(){return $(window).width()>640&&$(window).height()>640;}
function divecounter_open_ad(){if(windowLargeEnough()){$(function(){var _gaq=_gaq||window._gaq||(window._gaq=[]);var $form=$('#signup-inter').find('form');$form.find('.newsletter-partner').hide();var current_dialog;$('#signup-inter').modal({minWidth:400,maxWidth:600,minHeight:180,autoResize:true,autoPosition:true,overlayClose:false,focus:false,opacity:80,closeHTML:'<a href="#" title="Close" class="modal-close"></a>',onClose:divecounter_close_ad,onShow:function(dialog){_gaq.push(['_trackEvent','EmailSignup','InterstitialShown','simple',divecounter.getData().page_views,true]);$('#interstitial-error').hide();current_dialog=dialog;$('body').addClass('no-scroll');},});$form.find('input.email').on('blur',function(){checkEmailAndRespond(this);});$form.find('input.email').focus();if(current_dialog!=='undefined'){$(current_dialog.container).css('height','auto');}
$('#signup-inter form').submit(function(event){var email_regex=new RegExp('[^@]+@[^@]+[\.][^@]+');var email_value=$(this.email).val();var match_test=email_regex.test(email_value);var $interstitialError=$('#interstitial-error');var error_msg='';$interstitialError.hide();$(this).find('input[type=email]').removeClass('form-error__highlight');if(match_test&&isNewsletterSelectionValid()&&isUserConsentChecked()){var _gaq=_gaq||window._gaq||(window._gaq=[]);_gaq.push(['_trackEvent','EmailSignup','InterstitialSubmitted','simple',undefined,false]);return true;}else if(!match_test){error_msg='That is not a valid email address. Please enter a valid email.';$(this).find('input[type=email]').addClass('form-error__highlight');}else if(!isNewsletterSelectionValid()&&!isUserConsentChecked()){error_msg='You must select at least one newsletter and agree to our Terms of Use and Privacy Policy.';}else if(!isUserConsentChecked()){error_msg='You must agree to our Terms of Use and Privacy Policy.';}else if(!isNewsletterSelectionValid()){error_msg='Please select at least one newsletter.';}
$interstitialError.text(error_msg);$interstitialError.show();$('#simplemodal-container').css('height','auto');event.preventDefault();return false;});setTimeout(function(){$('.simplemodal-overlay').click($.modal.close);},750);});}}
var divecounter=new Divecounter();divecounter.countPageViews();if(window.location.search.indexOf('utm_source=Sailthru')!==-1){divecounter.markSubscriber();}
if(divecounter.getOption('markStaff')){divecounter.markStaff();}
if(divecounter.getOption('showSignupAd')||divecounter.testing()){if(divecounter.canShow()||divecounter.testing()){var prestitial_sniffer=setInterval(function(){if(typeof prestitial_ad_is_empty==='undefined'||prestitial_ad_is_empty===true){clearInterval(prestitial_sniffer);divecounter_open_ad();if(!divecounter.testing()){divecounter.markShown();divecounter.save();}}else if(typeof prestitial_ad_is_loaded!=='undefined'&&prestitial_ad_is_loaded===true){clearInterval(prestitial_sniffer);clearInterval(window.prestitial_sniffer_clear);}
if(typeof window.prestitialAds!=='undefined'&&typeof window.prestitial_sniffer_clear==='undefined'){window.prestitial_sniffer_clear=setTimeout(function(){clearInterval(prestitial_sniffer);},3900);}},50);}}
divecounter.save();(function(){function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires='; expires='+date.toGMTString();}else{var expires='';}
document.cookie=name+'='+value+expires+'; path=/';}
function readCookie(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length);}
return null;}
if(!readCookie('_referrer')){var referrer=document.referrer?document.referrer:window.location;if(referrer.length>150){referrer=referrer.slice(0,150);}
createCookie('_referrer',referrer);}})();