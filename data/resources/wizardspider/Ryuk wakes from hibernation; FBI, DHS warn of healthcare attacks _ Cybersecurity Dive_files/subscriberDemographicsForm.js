function setupFormCallbackAndCreateFormIfSub(siteName,spot){var thisID='#demographics-box-'+spot;var lyticsID=null;var diveInsiderMainPageUrl='https://www.industrydive.com/insiders/';var headlineValue='We\'re covering the news relevant to you.';var messageValue='Help us get it right by telling us more about you.';var successusMessageValue='Love our content? Become a '+
'<a href="'+diveInsiderMainPageUrl+'">Dive Insider</a> by referring others and get rewarded.';var okMessageValue='Submit';var fieldsToDisplay=[];var initialValues={'dive_company_type':'','dive_job_function':'','dive_job_level':'',};var demographicFormVariant='';var demographicFormDomain=window.location.hostname;var demographicFormDomainId=demographicFormDomain.indexOf('.com')!==-1?demographicFormDomain.split('.')[1]:demographicFormDomain;function pickAPublication(){return siteName.toLowerCase()==='education dive'?'Education Dive: Higher Ed':siteName;}
function decideIfUserIsSubscribed(usersAudienceArray){var siteNameLower=siteName.toLowerCase();var validSubscriberList=['any_$_subs'.replace('$',siteNameLower.replace(' ','_'))];var isSubscriber=false;if(siteNameLower==='education dive'){validSubscriberList=['any_higher_ed_dive_subs','any_k12_dive_subs'];}
for(var i=0;i<validSubscriberList.length;i++){if(usersAudienceArray.indexOf(validSubscriberList[i])>-1){isSubscriber=true;break;}}
return isSubscriber;}
function firstElementUpper(element){return element[0].toUpperCase()+element.slice(1);}
function fieldSlugToLabel(fieldSlug){return firstElementUpper(fieldSlug.replace('dive_','').replace('_',' '));}
function constructField(type,label,name){var field={'type':type,'label':label,'name':name,};return field;}
function constructDisplayField(fieldSlug,boxLocation){var type=fieldSlug.indexOf('dive_')>-1?'select':'text';return constructField(type,fieldSlugToLabel(fieldSlug),fieldSlug+'_'+boxLocation);}
function getDemographicFormId(){return demographicFormDomainId+'-'+demographicFormVariant+'-'+spot+'-box';}
var messages={success:{headline:'Thank you!',msg:successusMessageValue,delay:0,},error:{headline:'Error',msg:'There was an issue submitting your form.',delay:0,},};function sendGoogleAnalyticsDemographicsEvent(eventName,formConfiguration){if((typeof ga)!=='undefined'){ga('orig.send','event','Subscriber Demographics',eventName,formConfiguration);}}
function hasAtLeastOneValue(dataArray){return dataArray.reduce(function(acc,cur){return acc||cur.value!=='';},false);}
var confirmActionValue={waitForAsyncResponse:true,callback:function callbackFunction(event,payload,cb){var $errorMessageElement=$('.demo-box-error');var payloadData=payload.data;if(hasAtLeastOneValue(payloadData)){$errorMessageElement.remove();var jsonRequest={'lytics_id':lyticsID,};var varsToUpdateAsJson={};var formConfiguration='';for(var i=0;i<payloadData.length;i++){formConfiguration+=(formConfiguration===''?'':', ')+payloadData[i].name;if(payloadData[i].value.length!==0){varsToUpdateAsJson[payloadData[i].name]=payloadData[i].value;formConfiguration+=' filled';}else{formConfiguration+=' blank';}}
jsonRequest.fields_to_update=varsToUpdateAsJson;sendGoogleAnalyticsDemographicsEvent('Submit',formConfiguration);$.ajax({type:'POST',url:'/push-to-sailthru/',dataType:'json',data:{data:JSON.stringify(jsonRequest),},success:function(){addSuccessClassToAllForms();}});}else if($errorMessageElement.length===0){var errorMessage='<span class="demo-box-error">Oops! The form is empty.</span>';$(thisID+' .pf-widget-message').after(errorMessage);}},};function createFormOptions(){var defaultOptions={id:getDemographicFormId(),layout:'inline',position:thisID,headline:headlineValue,msg:messageValue,okMessage:okMessageValue,formElements:fieldsToDisplay,formStates:messages,confirmAction:confirmActionValue,theme:'custom',};if(spot.toLowerCase()==='sidebar'){defaultOptions['className']='demographic-form-sidebar';defaultOptions['image']='/static/img/demographic_form/demographics-collector-sidebar.png';defaultOptions['customButton']='button button--full-width';}
if(spot.toLowerCase()==='inline'){defaultOptions['className']='demographic-form-inline';defaultOptions['image']='/static/img/demographic_form/demographics-collector-sidebar.png';defaultOptions['customButton']='button button--medium';defaultOptions['includePolygon']=true;defaultOptions['isImageWrapped']=true;}
return defaultOptions;}
function hideSignUpForm(){$(thisID).prev().hide();$('.pre-footer .signup').hide();}
function showLyticsForm(){var formOptions=createFormOptions();var pathforaForm=new pathfora.Form(formOptions);pathfora.initializeWidgets([pathforaForm]);$(thisID).diveformify(pickAPublication(),{'strict_mode':true,'initial_values':initialValues});addCustomStyle(formOptions);hideSignUpForm();$(thisID).show();}
function removeLyticsButtonStyleAndAddCustomClass(cssSelector,buttonType){var button=$(cssSelector+' .pf-widget-btn.pf-widget-ok');$(button).addClass(buttonType);$(button).removeClass('pf-widget-btn');}
function addSuccessClassToAllForms(){$('[class*=demographic-form]').addClass('success').parent().addClass('success');}
function addImageWrapper(cssSelector){$(cssSelector+' img').wrap('<div class="pf-img-wrapper"></div>');}
function addPrivacyPolicy(cssSelector){var privacyPolicy='<p class="help-text help-text--small">'+
'<a class="pf-privacy-policy" href="http://www.industrydive.com/privacy-policy/" target="_blank">Privacy policy</a></p>';$(cssSelector+' .pf-widget-content').append(privacyPolicy);}
function addCustomStyle(config){var cssSelector=config.position;var buttonClass=config.customButton;var includePolygon=config.includePolygon;var isImageWrapped=config.isImageWrapped;addPrivacyPolicy(cssSelector);removeLyticsButtonStyleAndAddCustomClass(cssSelector,buttonClass);if(includePolygon){$(cssSelector).append('<div class="pf-polygon"></div>');}
if(isImageWrapped){addImageWrapper(cssSelector);}
if(config.formElements.length===1&&config.position==='#demographics-box-inline'){$(config.position+' button').addClass('special-button');}}
function createScript(appendChildToTagName,scriptObject){document.getElementsByTagName(appendChildToTagName)[0].appendChild(scriptObject);}
function loadJs(jsFilePath,async_,defer){var loadJsDeferred=$.Deferred();var scriptObject=document.createElement('script');scriptObject.async=async_;scriptObject.defer=defer;scriptObject.type='text/javascript';scriptObject.src=jsFilePath;scriptObject.onload=loadJsDeferred.resolve;createScript('head',scriptObject);return loadJsDeferred;}
function decideLyticsFormsToDisplay(id){lyticsID=id;$.ajax({type:'POST',url:'/decide-lytics-forms-to-display/',dataType:'json',data:{lytics_token:id,},success:function setFieldsToDisplay(demographicData){if(!$.isEmptyObject(demographicData)){var formConfiguration='';demographicFormVariant=demographicData.hasOwnProperty('variant')?demographicData.variant:'';var demographicFormFields=demographicData.hasOwnProperty('fields')?demographicData.fields:{};for(var i=0;i<demographicFormFields.length;i++){var fieldName=demographicFormFields[i].name;fieldsToDisplay.push(constructDisplayField(fieldName,spot));initialValues[fieldName]=demographicFormFields[i].value;formConfiguration+=(formConfiguration===''?'':', ')+fieldName+'_'+spot;}
sendGoogleAnalyticsDemographicsEvent('View',formConfiguration);showLyticsForm();var $CompanyName=$('#company_name_'+spot);if(!$CompanyName.val()){$CompanyName.val(initialValues.company_name);}}},});}
function loadDependencies(){var loadDiveFormFieldsJsDeferred=loadJs('/static/job_graph/dive-form-fields.js',1,null);var loadJobGraphJsDeferred=loadJs('//d1tawsf5ksqu42.cloudfront.net/job_graph/job_graph_v2.js',1,null);var loadPathfora=loadJs('https://c.lytics.io/static/pathfora.min.js',1,null);$.when(loadDiveFormFieldsJsDeferred,loadJobGraphJsDeferred,loadPathfora).done(function(){jstag.getid(decideLyticsFormsToDisplay);});}
var setupDemographicForm=function(profile){var userInValidSubscriberList=decideIfUserIsSubscribed(profile.data.user.segments);if(userInValidSubscriberList){loadDependencies();}};if(typeof jstag!=='undefined'){jstag.call('entityReady',setupDemographicForm);}}